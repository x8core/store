<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<script>
    (() => {
        let get = (name) => {
            let nameEQ = name + '=';
            let ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        let uuid = () => {
            function s4() { return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1) }
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4()
        }

        let myChannel = 'frontend:' + uuid();
        let token = get('token')

        let socket = new WebSocket(`wss://anyx.dev/?token=${token}`);
        socket.onopen = (event) => {
            console.log('subscribe to', myChannel)
            socket.send(JSON.stringify({
                subscribe: 1,
                channel: myChannel,
            }))
            socket.send(JSON.stringify({
                publish: 1,
                channel: 'getFrontend',
                responseToChannel: myChannel
            }))
            console.log('соединение установлено')
        }
        socket.onclose = (event) => {
            if (event.wasClean) console.log('Соединение закрыто чисто');
            else console.log('Обрыв соединения'); // например, "убит" процесс сервера
        }
        socket.onmessage = (event) => {
            console.log("Receive data", event.data);
        }
        socket.onerror = (error) => {
            console.log("Ошибка " + error);
        }
    })()
</script>

</body>
</html>